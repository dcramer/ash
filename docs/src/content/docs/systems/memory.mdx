---
title: Memory
description: Context management, extraction, and retrieval
sidebar:
  order: 5
---

import { Aside } from '@astrojs/starlight/components';

Ash memory combines:

- Session/chat history on disk under `~/.ash/`
- Structured memory entries in the graph store
- Semantic lookup via embeddings (optional)

## Configuration

```toml
[memory]
max_context_messages = 20
context_token_budget = 100000
recency_window = 10
system_prompt_buffer = 8000
compaction_enabled = true
auto_gc = true
max_entries = null
extraction_enabled = true
extraction_model = null
extraction_min_message_length = 20
extraction_debounce_seconds = 30
extraction_confidence_threshold = 0.7
```

### Key Options

| Option | Default | Purpose |
|--------|---------|---------|
| `max_context_messages` | `20` | Hard cap for recent context messages |
| `context_token_budget` | `100000` | Target context token budget |
| `recency_window` | `10` | Messages always preserved |
| `system_prompt_buffer` | `8000` | Reserve for instructions/tools |
| `compaction_enabled` | `true` | Summarize older context when needed |
| `auto_gc` | `true` | Run memory cleanup on startup |
| `max_entries` | `null` | Optional retention cap |
| `extraction_enabled` | `true` | Background fact extraction |
| `extraction_model` | `null` | Optional model alias override |
| `extraction_confidence_threshold` | `0.7` | Minimum confidence to store extracted facts |

## Embeddings

Enable semantic retrieval with:

```toml
[embeddings]
provider = "openai"
model = "text-embedding-3-small"
```

<Aside type="note">
  If embeddings are not configured, semantic memory tools are disabled and Ash falls back to non-embedding context behavior.
</Aside>

## Runtime Behavior

1. Incoming message is added to conversation context
2. Recent history is selected using recency + token-budget rules
3. Optional semantic retrieval adds relevant memories
4. Background extraction can persist new memories from conversation text

## CLI

```bash
uv run ash memory list
uv run ash memory search "project ideas"
uv run ash memory show <id>
uv run ash memory add -q "User prefers concise summaries"
uv run ash memory remove <id>
uv run ash memory gc
uv run ash memory stats
```
