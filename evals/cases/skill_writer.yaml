name: Skill Writer Behavior
description: Core tests for skill-writer phase compliance and skill quality

cases:
  # Phase compliance: research and plan are read-only
  - id: phases_are_read_only
    description: Research and plan phases must not write files or execute code
    prompt: "Create a skill that converts markdown to HTML"
    expected_behavior: |
      During research and plan phases, the agent must NOT:
      - Use bash to test or install anything
      - Write any files

      The agent should:
      1. Research: Find a suitable library (e.g., markdown, mistune)
      2. Plan: Delegate to plan agent or design the skill
      3. Both phases call interrupt before proceeding
    criteria:
      - Uses web_search/web_fetch or delegates to research agent
      - Calls interrupt after research phase
      - Does not use bash during research or plan phases
      - Does not write files during research or plan phases
    phase_constraints:
      research:
        expected_tools:
          - interrupt
        forbidden_tools:
          - bash
          - write_file
      plan:
        forbidden_tools:
          - bash
          - write_file
    tags:
      - phase_compliance

  # Skill quality: instructions must be actionable
  - id: skill_is_actionable
    description: Created skill should have imperative, actionable instructions
    prompt: "Create a skill that counts words in text"
    expected_behavior: |
      The created SKILL.md should:
      1. Use imperative voice: "Count the words" not "To count words..."
      2. Reference user input explicitly
      3. Specify expected output format

      Invoking the skill should execute immediately, not ask questions.
    criteria:
      - SKILL.md created successfully
      - Instructions use imperative voice
      - Instructions reference user input explicitly
      - Validation passes
    tags:
      - skill_quality

  # End-to-end: instruction-only skill
  - id: e2e_instruction_skill
    description: Full flow for instruction-only skill
    prompt: "Create a skill for reviewing Python code for security issues"
    expected_behavior: |
      Complete 3-phase flow:
      1. Research: Find Python security best practices
      2. Plan: Design instruction-only skill (no scripts needed)
      3. Implement: Create SKILL.md with security review guidelines
      4. Validate: ash-sb skill validate passes
    criteria:
      - Completes all 3 phases
      - No bash/writes during research and plan
      - Creates instruction-only skill (no .py files)
      - Validation passes
    phase_constraints:
      research:
        forbidden_tools:
          - bash
          - write_file
      plan:
        forbidden_tools:
          - bash
          - write_file
    tags:
      - e2e
      - instruction_only

  # End-to-end: Python skill
  - id: e2e_python_skill
    description: Full flow for Python-based skill
    prompt: "Create a skill that fetches a URL and summarizes the content"
    expected_behavior: |
      Complete 3-phase flow:
      1. Research: Find web fetching libraries (httpx, beautifulsoup)
      2. Plan: Design Python script + SKILL.md
      3. Implement: Create fetch.py and SKILL.md
      4. Validate and test
    criteria:
      - Completes all 3 phases
      - No bash/writes during research and plan
      - Creates .py script with PEP 723 dependencies
      - SKILL.md references the script correctly
      - Validation passes
    tags:
      - e2e
      - python_skill
