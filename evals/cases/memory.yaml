name: Memory Recall
description: Tests end-to-end memory flow - extraction from one session, recall in another

defaults:
  agent: memory
  drain_extraction: true
  session:
    provider: eval
    user_id: eval-user
    chat_type: private

setup:
  - messages:
      - "My favorite programming language is Rust and I live in Portland, Oregon."
    drain_extraction: true

cases:
  - id: memory_recall_cross_session
    description: Recall personal facts stated in a previous conversation
    prompt: "What do you remember about me? What's my favorite programming language and where do I live?"
    expected_behavior: |
      The assistant should recall facts from a previous conversation where the
      user stated their favorite programming language is Rust and they live in
      Portland, Oregon. The response should mention both facts and be conversational.
    criteria:
      - Mentions Rust as the favorite programming language
      - Mentions Portland or Oregon as the location
      - Response is conversational, not just raw data listing
    tags:
      - memory
      - recall

  - id: memory_recall_via_relationship
    description: Recall facts about a person through a relationship reference
    setup:
      - username: david
        display_name: "David Cramer"
        chat_type: private
        messages:
          - "Remember that Alice is my business partner"
        drain_extraction: true
      - username: david
        display_name: "David Cramer"
        chat_type: private
        messages:
          - "Remember Alice's product launch is scheduled for March 15"
        drain_extraction: true
    prompt: "When is my business partner's product launch?"
    expected_behavior: |
      The agent should recall that the user's business partner is Alice and
      that Alice's product launch is on March 15. The memories may have been
      automatically injected into context or retrieved via tools â€” either
      path is valid.
    criteria:
      - Identifies Alice as the business partner
      - Mentions March 15 as the product launch date
      - Response is conversational
    tags:
      - memory
      - recall
      - graph-retrieval
